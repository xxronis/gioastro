---
import '../styles/global.css';
import { api } from '../lib/drupal';
import { getImagesFromEntity, getImagesFromWork } from '../lib/jsonapi-images';

const articles = await api<{ data: any[], included?: any[] }>(
  '/node/work',
  { 'sort': '-created', 'page[limit]': '3', 'include': 'field_media,field_media.field_media_image' }
);
---

<h2 class="text-2xl font-bold mb-4">Featured Artwork</h2>
<ul class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {articles.data.map((n) => {
        const images = getImagesFromEntity(
            n,
            articles.included,
            import.meta.env.DRUPAL_BASE_URL || ''
        );
        const alias = n.attributes?.path?.alias ?? `/node/${n.id}`;
        const img = images[0];

    return (
        <li class="bg-white shadow overflow-hidden">
        <a class="block h-full" href={alias}>
            {/* image frame keeps consistent size; image keeps aspect ratio */}
            <div class="bg-gray-100 aspect-[4/3] flex items-center justify-center p-6">
            {img?.src && (
                <img
                class="max-w-full max-h-full object-contain"
                src={img.src}
                alt={img.alt ?? ''}
                loading="lazy"
                />
            )}
            </div>

            {/* <div class="p-4">
            <div class="text-blue-600 hover:underline font-medium">
                {n.attributes.title}
            </div>
            </div> */}
        </a>
        </li>
    );
    })}
</ul>
