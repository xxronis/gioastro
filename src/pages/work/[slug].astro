---
import '../../styles/global.css';
import { getCollection } from 'astro:content';
import { cfImg } from '../../lib/jsonapi-images';
import Layout from '../../layouts/Layout.astro';
import WorkDetail from '../../components/WorkDetail.astro';
import { parseMeta } from '../../lib/metatag';
import type { CollectionEntry } from 'astro:content';
export const prerender = true;

export async function getStaticPaths() {
  const works = await getCollection('work');
  return works
    .filter((e) => !!e.data.alias)
    .map((entry) => {
      const slug = entry.data.alias.split('/').filter(Boolean).pop() ?? entry.id;
      return { params: { slug }, props: { entry } };
    });
}

interface Props { entry: CollectionEntry<'work'> }
const { entry } = Astro.props;
const { title, body, images, metatag } = entry.data;
const meta = parseMeta(metatag);
---

<Layout
  title={meta.title ?? title}
  description={meta.description}
  ogTitle={meta.title ?? title}
  ogDescription={meta.description}
  ogImage={meta.ogImage ?? (images?.[0] ? cfImg(images[0].src, { width: 1200, quality: 85 }) : undefined)}
>
  <WorkDetail title={title} body={body} images={images} />
</Layout>

