---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Latest from "../components/Latest.drupal.astro";
import LoopVideo from "../components/LoopVideo.astro";
import { cfImg } from "../lib/jsonapi-images";
export const prerender = true;

const allWorks = await getCollection("work");
// Prefer promoted items; fall back to any 3 most recent if fewer than 3 are promoted
const promoted = allWorks.filter((e) => e.data.promoted);
const source = promoted.length >= 3 ? promoted : allWorks;
const featured = source.slice(0, 3);

const latestItems = featured.map((e) => ({
	alias: e.data.alias,
	img: e.data.images[0]
		? {
				src: cfImg(e.data.images[0].src, { width: 400, quality: 85 }),
				srcset: `${cfImg(e.data.images[0].src, { width: 400, quality: 85 })} 800w, ${cfImg(e.data.images[0].src, { width: 800, quality: 85 })} 1600w`,
				alt: e.data.images[0].alt,
			}
		: undefined,
}));
---

<Layout description="Giorgos Chronopoulos â€” original watercolor paintings and fine art.">
	<div class="h-[calc(100vh-10rem)] md:h-[calc(100vh-10rem)] lg:h-[calc(100vh-26rem)] w-full bg-[url('/bg1.webp')] bg-cover lg:bg-[position:0_20%] relative">
		<LoopVideo />
	</div>

	<div class="py-8">
		<div class="container mx-auto w-[80%]">
			<Latest items={latestItems} />
			<div class="flex justify-end mt-4">
				<a
					href="/work"
					class="flex items-center gap-2 text-sm hover:underline"
				>
					View All Work
					<svg
						viewBox="0 0 20 20"
						class="h-4 w-4 fill-none stroke-current stroke-2"
						stroke-linecap="round"
						stroke-linejoin="round"
						aria-hidden="true"
					>
						<path d="M4 10h12M12 5l5 5-5 5"></path>
					</svg>
				</a>
			</div>
		</div>
	</div>
</Layout>
